{% extends "base.html" %}

{% block title %}Home â€“ All Items{% endblock %}

{% block content %}
<div class="container mt-4">
  <h3>All Items</h3>
  {% if items %}
    <div class="row">
      {% for item in items %}
        <div class="col-6 col-sm-4 col-md-3 mb-4">
          <div class="card h-100">
            {# optional thumbnail if available: <img src="{{ item.thumbnail_url }}" class="card-img-top" alt="{{ item.title }}"> #}
            <div class="card-body d-flex flex-column">
              <h5 class="card-title mb-2">
                <a href="{{ url_for('item_detail', item_id=item.id) }}">{{ item.title }}</a>
              </h5>
              {# Display current price or auction status instead of owner #}
              <div class="card-text mt-auto mb-0">
                {% set open_auction = item.auctions | selectattr('status','equalto','open') | first %}
                {% if open_auction %}
                  {% if open_auction.bids %}
                    {% set highest_bid = open_auction.bids | map(attribute='amount') | max %}
                  {% else %}
                    {% set highest_bid = open_auction.init_price %}
                  {% endif %}
                  <small class="text-muted">Current Price: {{ highest_bid }}</small>
                {% else %}
                  <small class="text-muted">Not opened for auction</small>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <p class="text-muted">No items available yet.</p>
  {% endif %}
</div>
{% endblock %}
